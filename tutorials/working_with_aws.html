<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Working with QIIME on Amazon Web Services EC2 &mdash; Homepage</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.9.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Homepage" href="../index.html" />
    <link rel="up" title="QIIME Tutorials" href="index.html" />
    <link rel="next" title="Using parallel QIIME" href="parallel_qiime.html" />
    <link rel="prev" title="Getting started with the command line" href="unix_commands.html" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<script type="text/javascript" src="http://www.google.com/jsapi?key=ABQIAAAAbW_pA971hrPgosv-Msv7hRRE2viNBUPuU405tK6p2cguOFmlFBQSwZMG6_q_v6Z42nkdo9ejT1aHmA"></script>
<script type="text/javascript" src="../_static/google_feed.js"></script>

  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 0px">
<a href="../index.html"><img src="../_static/wordpressheader.png" border="0" alt="sampledoc"/></a>
</div>
<div class="news" style="background-color:#ccc;"><table style="font-size:12pt;padding: 5px;"><tr id="feed"><td><b>News and Announcements &raquo;</b></td>
</tr></table></div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="parallel_qiime.html" title="Using parallel QIIME"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="unix_commands.html" title="Getting started with the command line"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">QIIME Tutorials</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="working-with-qiime-on-amazon-web-services-ec2">
<span id="working-with-ec2"></span><h1>Working with QIIME on Amazon Web Services EC2<a class="headerlink" href="#working-with-qiime-on-amazon-web-services-ec2" title="Permalink to this headline">¶</a></h1>
<p>This document covers general steps for working with QIIME on Amazon Web Services (AWS).  If you&#8217;re completely new to AWS, you should start with the <a class="reference external" href="http://aws.amazon.com/documentation/gettingstarted/">AWS Getting Started documentation</a>. We refer readers there as this will be more up-to-date than what you&#8217;ll find on the QIIME website. This document covers the details that you&#8217;ll need to start an AWS instance, but doesn&#8217;t walk you through the AWS interface as that often changes.</p>
<div class="section" id="starting-a-qiime-ec2-instance">
<h2>Starting a QIIME EC2 instance<a class="headerlink" href="#starting-a-qiime-ec2-instance" title="Permalink to this headline">¶</a></h2>
<p>These details assume that you have logged into your AWS account, and are starting an EC2 instance. The information that you&#8217;ll need to start a QIIME instance follows. Defaults can be used except as noted below.</p>
<div class="section" id="ami">
<h3>AMI<a class="headerlink" href="#ami" title="Permalink to this headline">¶</a></h3>
<p>You will need the AMI for the QIIME image that you want to run. This tells Amazon what specific virtual machine you want to launch. You can always find the latest QIIME AMI on the <a class="reference external" href="http://qiime.org/home_static/dataFiles.html">QIIME resources page</a>. You&#8217;ll need to search for the QIIME AMI under <em>Community AMIs</em>. You must be in the <em>US East</em> region when logged into your AWS account.</p>
</div>
<div class="section" id="instance-type">
<h3>Instance type<a class="headerlink" href="#instance-type" title="Permalink to this headline">¶</a></h3>
<p>Choosing the instance type depends on what you want to do with QIIME on AWS. The available instance types and pricing are described <a class="reference external" href="http://www.ec2instances.info/">here</a>. The <tt class="docutils literal"><span class="pre">m1.large</span></tt> instance should be sufficient if you&#8217;re working with the QIIME tutorials, and for most QIIME analyses <strong>if you do not plan to run parallel jobs</strong>. See <a class="reference internal" href="parallel_qiime.html"><em>Using parallel QIIME</em></a> for more details about setting up and using parallel QIIME. For larger jobs, such as parallel OTU picking on Illumina data, you likely want to use an <tt class="docutils literal"><span class="pre">m2.4xlarge</span></tt> instance (which has more memory and processors).</p>
</div>
<div class="section" id="security-group">
<h3>Security group<a class="headerlink" href="#security-group" title="Permalink to this headline">¶</a></h3>
<p>To log into your QIIME instance, you&#8217;ll need to have ssh access (i.e., port 22), which is enabled by default.</p>
<p>If you want to use the <a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/htmlnotebook.html">IPython Notebook</a> on your instance, you&#8217;ll need to add another security rule. The <em>Type</em> should be <tt class="docutils literal"><span class="pre">Custom</span> <span class="pre">TCP</span> <span class="pre">Rule</span></tt>, the <em>Protocol</em> should be <tt class="docutils literal"><span class="pre">TCP</span></tt>, the <em>Port Range</em> should be <tt class="docutils literal"><span class="pre">8888</span></tt>, and the <em>Source</em> should be <tt class="docutils literal"><span class="pre">Anywhere</span></tt>.</p>
</div>
</div>
<div class="section" id="connecting-to-your-qiime-ec2-instance-using-ssh">
<h2>Connecting to your QIIME EC2 instance using ssh<a class="headerlink" href="#connecting-to-your-qiime-ec2-instance-using-ssh" title="Permalink to this headline">¶</a></h2>
<p>To connect to your EC2 instance with ssh you&#8217;ll need your key file, the Public IP address for your running EC2 instance, and an ssh client. You should have created and downloaded a key file when creating your EC2 instance (or indicated that you&#8217;re using one that you&#8217;ve already created). On OS X and Linux, be sure that the permissions are set to <tt class="docutils literal"><span class="pre">400</span></tt> on this file, or you won&#8217;t be able to use it. If your key file is called <tt class="docutils literal"><span class="pre">$HOME/my_key.pem</span></tt> you can set the permissions with the command:</p>
<div class="highlight-python"><div class="highlight"><pre>chmod 400 $HOME/my_key.pem
</pre></div>
</div>
<p>If you&#8217;re working on OS X or Linux, you already have an ssh client installed. If you&#8217;re working on Windows, one free option is <a class="reference external" href="http://mobaxterm.mobatek.net/">MobaXterm</a>.</p>
<p>To connect to your running EC2 instance using ssh from Linux or OS X you&#8217;ll use a command like the following:</p>
<div class="highlight-python"><div class="highlight"><pre>ssh -i PATH_TO_KEY ubuntu@PUBLIC_IP_ADDRESS
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">When working with the QIIME AWS instance, you should always be logged in as the <tt class="docutils literal"><span class="pre">ubuntu</span></tt> user. This applies when running commands directly on an instance (when you&#8217;ve connected using ssh) or through an IPython Notebook. You can confirm that you are running as the correct user by running  <tt class="docutils literal"><span class="pre">whoami</span></tt>, and confirming that <tt class="docutils literal"><span class="pre">ubuntu</span></tt> is displayed.</p>
</div>
</div>
<div class="section" id="connecting-to-your-qiime-ec2-instance-using-the-ipython-notebook">
<h2>Connecting to your QIIME EC2 instance using the IPython Notebook<a class="headerlink" href="#connecting-to-your-qiime-ec2-instance-using-the-ipython-notebook" title="Permalink to this headline">¶</a></h2>
<p>To connect to your EC2 instance using the <a class="reference external" href="http://ipython.org/ipython-doc/stable/interactive/htmlnotebook.html">IPython Notebook</a>, you will have first need to configured your security group to allow TCP traffic over port 8888. See the instructions above for a description of how to do that. After you&#8217;ve booted your instance, you&#8217;ll first need to connect using ssh (see instructions in the previous section) and start the IPython Notebook server in a screen session. (See <a class="reference external" href="unix_commands.html">here</a> if you need help using screen.) You should enter the following commands to start the IPython Notebook server:</p>
<div class="highlight-python"><div class="highlight"><pre>screen
ipython notebook
</pre></div>
</div>
<p>You can then connect to the server by going to <tt class="docutils literal"><span class="pre">http://PUBLIC_IP_ADDRESS:8888</span></tt> in your web browser. The password will be <tt class="docutils literal"><span class="pre">qiime</span></tt>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is not a secure IPython Notebook server for several reasons. Anyone who has your public IP address and this password will be able to access your IPython Notebook server, and effectively run anything they want on your instance. For securing your IPython Notebook server, see <a class="reference external" href="http://ipython.org/ipython-doc/2/notebook/public_server.html">here</a>. Note that the QIIME AMI already has an IPython profile. If you&#8217;d like to change settings for the notebook (e.g., to change the password, configure SSL, etc.) you can modify the default IPython profile located in <tt class="docutils literal"><span class="pre">$HOME/.ipython/profile_default/</span></tt>.</p>
</div>
</div>
<div class="section" id="setting-the-qiime-temporary-directory">
<h2>Setting the QIIME temporary directory<a class="headerlink" href="#setting-the-qiime-temporary-directory" title="Permalink to this headline">¶</a></h2>
<p>By default the QIIME temporary directory is set to <tt class="docutils literal"><span class="pre">$HOME/temp/</span></tt> which will work for most cases but it can cause issues if your dataset is large as there may not be enough space on the filesystem containing <tt class="docutils literal"><span class="pre">$HOME/temp/</span></tt>. In this case you will need to set your <tt class="docutils literal"><span class="pre">temp_dir</span></tt> variable within your <tt class="docutils literal"><span class="pre">qiime_config</span></tt> file to a different directory on a file system that has more space. Note: if you are running in a parallel environment that makes use of multiple AWS instances, for example <a class="reference internal" href="#using-qiime-with-starcluster-and-the-ipython-notebook"><em>Using QIIME with StarCluster</em></a>, the <tt class="docutils literal"><span class="pre">temp_dir</span></tt> must point to a location that is accessible (usually NFS-shared) across all of the instances.</p>
<p>For details on modifying your <tt class="docutils literal"><span class="pre">qiime_config</span></tt>, see <a class="reference internal" href="../install/qiime_config.html"><em>Setting up your qiime config file</em></a>. For details on configuring parallel QIIME (which will be helpful if you&#8217;re using multiple AWS instances), see <a class="reference internal" href="parallel_qiime.html"><em>Using parallel QIIME</em></a>.</p>
</div>
<div class="section" id="getting-data-into-and-out-of-your-qiime-ec2-instance">
<h2>Getting data into and out of your QIIME EC2 instance<a class="headerlink" href="#getting-data-into-and-out-of-your-qiime-ec2-instance" title="Permalink to this headline">¶</a></h2>
<p>After you&#8217;ve launched your EC2 instance you&#8217;ll likely want to get data into it. After completing your analysis, you&#8217;ll then want to get your data out. It&#8217;s a good idea to pull your important data back out of your EC2 instance as soon as possible to avoid any issues with losing data if any Amazon systems go down, or if you accidentally terminate your instance.</p>
<p>You can get data into and out of your running EC2 instance with a graphical tool or via the command line, which ever you find more convenient. Command line tools such as <tt class="docutils literal"><span class="pre">scp</span></tt> and <tt class="docutils literal"><span class="pre">sftp</span></tt> work fine for this. A good, free graphical tool for Windows and OS X is <a class="reference external" href="http://cyberduck.ch/">Cyberduck</a>. This supports interacting with S3 buckets as well as EC2 instances (via sftp).</p>
<p>You will likely want to compress your files for each transfer. You can do this with the tar/gzip commands, or with a tool like WinZip on Windows. See <a class="reference internal" href="unix_commands.html#unix-commands"><em>Getting started with the command line</em></a> for help with these commands.</p>
<div class="section" id="working-with-command-line-file-transfer-tools">
<h3>Working with command line file transfer tools<a class="headerlink" href="#working-with-command-line-file-transfer-tools" title="Permalink to this headline">¶</a></h3>
<p>The primary tool for moving data into and out of your EC2 instance is <tt class="docutils literal"><span class="pre">scp</span></tt>.</p>
<p>To copy data into your EC2 instance you&#8217;ll need to know that path to your key file, and the Public IP Address for your EC2 instance.</p>
<p>Your <tt class="docutils literal"><span class="pre">scp</span></tt> command will look like the following to transfer data into your EC2 instance:</p>
<div class="highlight-python"><div class="highlight"><pre>scp -i PATH_TO_KEY PATH_TO_SOURCE_FILE ubuntu@PUBLIC_IP_ADDRESS:PATH_TO_DESTINATION_FILE
</pre></div>
</div>
<p>To transfer a file out of your EC2 instance, your command will look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>scp -i PATH_TO_KEY ubuntu@PUBLIC_IP_ADDRESS:PATH_TO_SOURCE_FILE PATH_TO_DESTINATION_FILE
</pre></div>
</div>
</div>
<div class="section" id="working-with-cyberduck">
<h3>Working with Cyberduck<a class="headerlink" href="#working-with-cyberduck" title="Permalink to this headline">¶</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The screenshots presented in this section may be outdated. Also, while these instructions and screenshots have you connect using the <em>Public DNS Entry</em> for your instance, you can connect with either the <em>Public DNS Entry</em> or the <em>Public IP Address</em> in exactly the same way.</p>
</div>
<p>Follow these steps to use Cyberduck to transfer data in and out of your AWS instance:</p>
<blockquote>
<div><ol class="arabic">
<li><p class="first">Download and install <a class="reference external" href="http://cyberduck.ch/">Cyberduck</a>. Installing should be straight-forward on OS X and Windows.</p>
</li>
<li><p class="first">Launch Cyberduck by using your normal procedure for launching programs. You should see the Cyberduck window open. A new window or sheet will open.</p>
</li>
<li><p class="first">To open a connection to your EC2 instance, click the &#8216;Open Connection&#8217; icon on the top-left. Choose &#8220;SFTP (SSH File Transfer Protocol)&#8221; in the dropdown box (not Amazon Simple Storage Service!). In the <tt class="docutils literal"><span class="pre">Server</span></tt> field, enter the text from the <tt class="docutils literal"><span class="pre">Public</span> <span class="pre">DNS</span></tt> field associated with this instance (see Figure 1 for where to find this information). In the <tt class="docutils literal"><span class="pre">Username</span></tt> field enter <tt class="docutils literal"><span class="pre">ubuntu</span></tt> (exactly as written here). Do not enter a password. Expand the <tt class="docutils literal"><span class="pre">More</span> <span class="pre">Options</span></tt> section in the bottom of this window, and click the <tt class="docutils literal"><span class="pre">Use</span> <span class="pre">Public</span> <span class="pre">Key</span> <span class="pre">Authentication</span></tt>. A dialog will open - navigate to where you&#8217;ve stored your key and select the key that is associated with this instance. After filling in the field, the window should look like that in Figure 1. Click <tt class="docutils literal"><span class="pre">Connect</span></tt>.</p>
<blockquote>
<div><img alt="../_images/cyberduck_open_connection.png" src="../_images/cyberduck_open_connection.png" />
<p>Figure 1: Initiating a new connection.</p>
</div></blockquote>
</li>
<li><p class="first">After connecting, you&#8217;ll see a file browser on the remote system (Figure 2). If you&#8217;ve just created this instance you won&#8217;t see any files listed (because you haven&#8217;t put anything there yet). You can drag-and-drop files from your local system to your EC2 instance now (Figure 3). Those files will now be visible on the EC2 instance (Figure 4).</p>
<blockquote>
<div><img alt="../_images/cyberduck_opened_connection.png" src="../_images/cyberduck_opened_connection.png" />
<p>Figure 2. Remote file browser.</p>
<a class="reference internal image-reference" href="../_images/cyberduck_drag_and_drop_input_file.png"><img alt="../_images/cyberduck_drag_and_drop_input_file.png" src="../_images/cyberduck_drag_and_drop_input_file.png" style="width: 700px;" /></a>
<p>Figure 3. Drag and drop a local file to the EC2 instance.</p>
<img alt="../_images/cyberduck_view_file.png" src="../_images/cyberduck_view_file.png" />
<p>Figure 4. Transferred file is visible on the EC2 instance.</p>
</div></blockquote>
</li>
<li><p class="first">When you run commands on the remote system, new output files and directories will be created (Figure 5). To drag those back to your local system, first switch to the Cyberduck window and hit the refresh icon. You should then see the newly created files, and you can drag and drop them back to your local system (Figure 6).</p>
<blockquote>
<div><img alt="../_images/cyberduck_create_output_file.png" src="../_images/cyberduck_create_output_file.png" />
<p>Figure 5. Create an output file on the EC2 instance.</p>
<a class="reference internal image-reference" href="../_images/cyberduck_drag_and_drop_output_file.png"><img alt="../_images/cyberduck_drag_and_drop_output_file.png" src="../_images/cyberduck_drag_and_drop_output_file.png" style="width: 700px;" /></a>
<p>Figure 6. Transfer file from the EC2 instance to the local system.</p>
</div></blockquote>
</li>
</ol>
</div></blockquote>
<p>Get help with Cyberduck <a class="reference external" href="http://trac.cyberduck.ch/wiki/help/en">here</a>.</p>
</div>
<div class="section" id="using-wget-to-get-data-into-your-instance">
<h3>Using wget to get data into your instance<a class="headerlink" href="#using-wget-to-get-data-into-your-instance" title="Permalink to this headline">¶</a></h3>
<p>If you want to download data that is publicly hosted on the internet into your instance, you can likely use the <tt class="docutils literal"><span class="pre">wget</span></tt> command to pull data from its URL. An example of this might look like the following:</p>
<div class="highlight-python"><div class="highlight"><pre>wget ftp://greengenes.microbio.me/greengenes_release/gg_13_5/gg_13_8_otus.tar.gz
</pre></div>
</div>
<p>This will download the <tt class="docutils literal"><span class="pre">gg_13_8_otus.tar.gz</span></tt> file (the Greengenes reference OTUs) to your EC2 instance. You can find details on <a class="reference external" href="http://www.gnu.org/software/wget/">wget here</a>.</p>
</div>
</div>
<div class="section" id="stopping-your-ec2-instances">
<h2>Stopping your EC2 instances<a class="headerlink" href="#stopping-your-ec2-instances" title="Permalink to this headline">¶</a></h2>
<p>As long as your EC2 instances are running, you&#8217;re paying for them by the hour. When you&#8217;re temporarily done using your EC2 instance, you can stop it from the AWS Management Console by selecting the instance and choosing <tt class="docutils literal"><span class="pre">Instance</span> <span class="pre">Actions</span></tt> &gt; <tt class="docutils literal"><span class="pre">Stop</span></tt> (see Figure 7). Note that you still pay a very small storage fee for stopped instances, so if you&#8217;re permanently done with an instance you probably want to terminate it. You can restart a stopped EC2 instance by selecting that instance and choosing <tt class="docutils literal"><span class="pre">Instance</span> <span class="pre">Actions</span></tt> &gt; <tt class="docutils literal"><span class="pre">Start</span></tt>.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/stop_instance.png"><img alt="../_images/stop_instance.png" src="../_images/stop_instance.png" style="width: 700px;" /></a>
<p>Figure 7. Stopping or pausing an EC2 instance.</p>
</div></blockquote>
<p>If you&#8217;re permanently done with an EC2 instance, you can terminate it by selecting the instance and choosing <tt class="docutils literal"><span class="pre">Instance</span> <span class="pre">Actions</span></tt> &gt; <tt class="docutils literal"><span class="pre">Terminate</span></tt>. Once you&#8217;ve terminated an instance you can never get it back: all data in that instance, as well as any configuration changes you&#8217;ve made, etc, is lost forever, so be sure this is what you want to do.</p>
</div>
<div class="section" id="creating-a-volume-for-persistent-storage-across-different-launches-of-an-instance-or-different-instances">
<span id="id5"></span><h2>Creating a volume for persistent storage across different launches of an instance (or different instances)<a class="headerlink" href="#creating-a-volume-for-persistent-storage-across-different-launches-of-an-instance-or-different-instances" title="Permalink to this headline">¶</a></h2>
<p>The disk space is fairly limited on the EC2 instances. To get around this you can create a volume (the equivalent of an external hard drive) and mount that on your instance. Data that you store in this volume can be accessed across different launches of an instance, or across different instances, but can only be attached to one instance at a time.</p>
<p>Use the management console to create a volume. To do this, first click the <tt class="docutils literal"><span class="pre">EC2</span></tt> tab. Next, select <tt class="docutils literal"><span class="pre">Volumes</span></tt> on the left sidebar. Then click <tt class="docutils literal"><span class="pre">Create</span> <span class="pre">Volume</span></tt>. See Figure 8.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/create_an_ebs_volume.png"><img alt="../_images/create_an_ebs_volume.png" src="../_images/create_an_ebs_volume.png" style="width: 800px;" /></a>
<p>Figure 8: Create an EBS Volume.</p>
</div></blockquote>
<p>Next you must configure the volume you want to create. You have three options here. First, define the size of the volume. This will be based on the amount of data that you&#8217;ll need to store. Creating a volume that is around 10x the size of the raw data you want to analyze should leave you plenty of disk space for your analysis. Next, you must define what <tt class="docutils literal"><span class="pre">Availability</span> <span class="pre">Zone</span></tt> you&#8217;d like to launch your instance in. This <strong>must</strong> be the same zone that your instance is running in. This information is available under the &#8216;Description&#8217; tab associated with your running instance (see <tt class="docutils literal"><span class="pre">Zone</span></tt> toward the bottom right of Figure 7). Last, you can define an snapshot that you&#8217;d like to create your volume from. You typically won&#8217;t use that here. See Figure 9.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/configure_ebs_volume_creation.png"><img alt="../_images/configure_ebs_volume_creation.png" src="../_images/configure_ebs_volume_creation.png" style="width: 700px;" /></a>
<p>Figure 9: Configure EBS volume creation.</p>
</div></blockquote>
<p>Finally, you&#8217;ll attach your volume to your instance: the equivalent of plugging the USB hard drive into the computer. To do this, click the checkbox next to your volume, select <tt class="docutils literal"><span class="pre">More</span></tt> and then <tt class="docutils literal"><span class="pre">Attach</span> <span class="pre">Volume</span></tt>. Select the instance that you&#8217;d like to attach your volume to. If you don&#8217;t see your instance it may not be running, or you may have not selected the correct <tt class="docutils literal"><span class="pre">Availability</span> <span class="pre">Zone</span></tt>. Take note of the value associated with <tt class="docutils literal"><span class="pre">Device</span></tt>. You&#8217;ll need this in the next step (we&#8217;ll call this the attachment point). See Figure 10.</p>
<blockquote>
<div><a class="reference internal image-reference" href="../_images/configure_ebs_volume_attachment.png"><img alt="../_images/configure_ebs_volume_attachment.png" src="../_images/configure_ebs_volume_attachment.png" style="width: 700px;" /></a>
<p>Figure 10: Configure EBS volume attachment.</p>
</div></blockquote>
<p>ssh into your EC2 instance and run the following commands. In this example, I&#8217;m assuming that your attachment point is <tt class="docutils literal"><span class="pre">/dev/sdf/</span></tt>. If it&#8217;s not, replace all occurrences of <tt class="docutils literal"><span class="pre">/dev/sdf/</span></tt> with your actual attachment point.</p>
<p>The first time you use your volume you&#8217;ll need to run this command. Do not run this command on an instance that you already have data in - that will erase your data!</p>
<div class="highlight-python"><div class="highlight"><pre>sudo mkfs.ext4 /dev/sdf
</pre></div>
</div>
<p>One your first time attaching a volume to a new instance, you&#8217;ll need to run this command:</p>
<div class="highlight-python"><div class="highlight"><pre>mkdir $HOME/data
</pre></div>
</div>
<p>Anytime you attach or re-attach your volume to an instance (so after starting a new or stopped instance) you&#8217;ll need to run these commands:</p>
<div class="highlight-python"><div class="highlight"><pre>sudo mount /dev/sdf $HOME/data
sudo chown ubuntu $HOME/data
sudo chgrp ubuntu $HOME/data
</pre></div>
</div>
<p>Once you&#8217;ve created your device, you only need to go through the attachment step to attach to future instances. This is the step illustrated in Figure 10. Note that you&#8217;ll need to create future instances in the same availability zone as this volume if you&#8217;d like to attach this volume.</p>
</div>
<div class="section" id="using-qiime-with-starcluster">
<span id="using-qiime-with-starcluster-and-the-ipython-notebook"></span><h2>Using QIIME with StarCluster<a class="headerlink" href="#using-qiime-with-starcluster" title="Permalink to this headline">¶</a></h2>
<p>QIIME instances can be loaded using <a class="reference external" href="http://web.mit.edu/star/cluster/">StarCluster</a>, which provides a convenient means for starting and using virtual clusters on AWS.</p>
<p>To start using <a class="reference external" href="http://web.mit.edu/star/cluster/">StarCluster</a>, you should see their install instructions. Your StarCluster config file should look like this:</p>
<div class="highlight-python"><div class="highlight"><pre>[cluster my.qiime.cluster]
node_image_id = LATEST-QIIME-AMI # see http://qiime.org/home_static/dataFiles.html
cluster_user = ubuntu
keyname = YOUR-KEY
cluster_size = DESIRED-CLUSTER-SIZE
node_instance_type = DESIRED-INSTANCE-TYPE
</pre></div>
</div>
<p>Everything in CAPS should be replaced with the corresponding information.</p>
<p>After launching your cluster, we recommend that you connect as the <tt class="docutils literal"><span class="pre">ubuntu</span></tt> user. You can do this as follows:</p>
<div class="highlight-python"><div class="highlight"><pre>starcluster sshmaster CLUSTER_TAG -u ubuntu
</pre></div>
</div>
<p>where <tt class="docutils literal"><span class="pre">CLUSTER_TAG</span></tt> refers to the cluster_tag that was specified when you launched your cluster with <tt class="docutils literal"><span class="pre">starcluster</span> <span class="pre">start</span></tt>.</p>
<p>To run jobs in parallel on this system, you&#8217;ll next need to create the <tt class="docutils literal"><span class="pre">$HOME/.qiime_config</span></tt> file on the cluster. This file should contain the following line:</p>
<div class="highlight-python"><div class="highlight"><pre>cluster_jobs_fp start_parallel_jobs_sc.py
</pre></div>
</div>
</div>
<div class="section" id="video-tutorial">
<h2>Video tutorial<a class="headerlink" href="#video-tutorial" title="Permalink to this headline">¶</a></h2>
<p>These steps described here are also covered in the <a class="reference external" href="http://www.youtube.com/watch?v=PEcSL_7D-jo">QIIME EC2 video</a>, though that video is now several years old so the AWS interface in the video may be different from what you see when you log in.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

    
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Working with QIIME on Amazon Web Services EC2</a><ul>
<li><a class="reference internal" href="#starting-a-qiime-ec2-instance">Starting a QIIME EC2 instance</a><ul>
<li><a class="reference internal" href="#ami">AMI</a></li>
<li><a class="reference internal" href="#instance-type">Instance type</a></li>
<li><a class="reference internal" href="#security-group">Security group</a></li>
</ul>
</li>
<li><a class="reference internal" href="#connecting-to-your-qiime-ec2-instance-using-ssh">Connecting to your QIIME EC2 instance using ssh</a></li>
<li><a class="reference internal" href="#connecting-to-your-qiime-ec2-instance-using-the-ipython-notebook">Connecting to your QIIME EC2 instance using the IPython Notebook</a></li>
<li><a class="reference internal" href="#setting-the-qiime-temporary-directory">Setting the QIIME temporary directory</a></li>
<li><a class="reference internal" href="#getting-data-into-and-out-of-your-qiime-ec2-instance">Getting data into and out of your QIIME EC2 instance</a><ul>
<li><a class="reference internal" href="#working-with-command-line-file-transfer-tools">Working with command line file transfer tools</a></li>
<li><a class="reference internal" href="#working-with-cyberduck">Working with Cyberduck</a></li>
<li><a class="reference internal" href="#using-wget-to-get-data-into-your-instance">Using wget to get data into your instance</a></li>
</ul>
</li>
<li><a class="reference internal" href="#stopping-your-ec2-instances">Stopping your EC2 instances</a></li>
<li><a class="reference internal" href="#creating-a-volume-for-persistent-storage-across-different-launches-of-an-instance-or-different-instances">Creating a volume for persistent storage across different launches of an instance (or different instances)</a></li>
<li><a class="reference internal" href="#using-qiime-with-starcluster">Using QIIME with StarCluster</a></li>
<li><a class="reference internal" href="#video-tutorial">Video tutorial</a></li>
</ul>
</li>
</ul>


    <h3><a href="../index.html">Site index</a></h3>
    <ul><li><ul>
    <li><a href="http://www.qiime.org">Home</a><br /></li>
    <li><a href="../install/index.html">Install</a><br /></li>
    <li><a href="index.html">Tutorials</a><br /></li>
    <li><a href="../scripts/index.html">Scripts</a><br /></li>
    <li><a href="http://help.qiime.org">Help</a><br /></li>
    <li><a href="http://qiime.org/home_static/dataFiles.html">Resources</a><br /></li>
    <li><a href="../documentation/index.html">File Formats</a><br /></li>
    <li><a href="http://workshops.qiime.org">Workshops</a><br /></li>
    <li><a href="http://qiime.wordpress.com">Blog</a><br /></li>
    <li><a href="../developer/index.html">Developer</a><br /></li>
    </ul></li></ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="unix_commands.html"
                        title="previous chapter">Getting started with the command line</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="parallel_qiime.html"
                        title="next chapter">Using parallel QIIME</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="parallel_qiime.html" title="Using parallel QIIME"
             >next</a> |</li>
        <li class="right" >
          <a href="unix_commands.html" title="Getting started with the command line"
             >previous</a> |</li>
        <li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="index.html" >QIIME Tutorials</a> &raquo;</li> 
      </ul>
    </div>
<div style="text-align: center; padding: 0px;"><br />
<a href="http://www.scikit-bio.org" target="_blank"><img src="../_static/powered_by_skbio.png" border="0" alt="sampledoc" height="70px"/></a>
<br /></div>

    <div class="footer">
        &copy; Copyright 2010-2014, QIIME Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6636235-4");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>