<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Performing Procrustes Analysis &mdash; Homepage</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="top" title="Homepage" href="../index.html" />
    <link rel="up" title="QIIME Tutorials" href="index.html" />
    <link rel="next" title="Tracking the source of microbes with SourceTracker" href="source_tracking.html" />
    <link rel="prev" title="Running Supervised Learning" href="running_supervised_learning.html" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<script type="text/javascript" src="http://www.google.com/jsapi?key=ABQIAAAAbW_pA971hrPgosv-Msv7hRRE2viNBUPuU405tK6p2cguOFmlFBQSwZMG6_q_v6Z42nkdo9ejT1aHmA"></script>
<script type="text/javascript" src="../_static/google_feed.js"></script>

  </head>
  <body>

<div style="background-color: white; text-align: left; padding: 0px">
<a href="../index.html"><img src="../_static/wordpressheader.png" border="0" alt="sampledoc"/></a>
</div>
<div class="news" style="background-color:#ccc;"><table style="font-size:12pt;padding: 5px;"><tr id="feed"><td><b>News and Announcements &raquo;</b></td>
</tr></table></div>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="source_tracking.html" title="Tracking the source of microbes with SourceTracker"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="running_supervised_learning.html" title="Running Supervised Learning"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">QIIME Tutorials</a> &raquo;</li> 
      </ul>
    </div>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="performing-procrustes-analysis">
<span id="procrustes-analysis"></span><h1>Performing Procrustes Analysis<a class="headerlink" href="#performing-procrustes-analysis" title="Permalink to this headline">¶</a></h1>
<p>This tutorial covers how to perform Procrustes Analysis (<a class="reference external" href="http://link.springer.com/article/10.1007%2FBF02291478">Gower (1975)</a>) using QIIME to compare weighted and unweighted UniFrac PCoA plots generated by the same processing pipeline. Procrustes analysis takes as input two coordinate matrices with corresponding points (in QIIME, these are generated by running <tt class="docutils literal"><span class="pre">principal_coordinates.py</span></tt> on a distance matrix generated by <tt class="docutils literal"><span class="pre">beta_diversity.py</span></tt>), and transforming the second coordinate set by rotating, scaling, and translating it to minimize the distances between corresponding points in the two shapes. This is done with <tt class="docutils literal"><span class="pre">transform_coordinate_matrices.py</span></tt>. The results can then be visualized using QIIME by running <a class="reference external" href="http://emperor.colorado.edu/">make_emperor.py</a> and using the <tt class="docutils literal"><span class="pre">-c/--compare_plots</span></tt> option. Both sets of coordinates will be plotted in the resulting figure, with bars connecting the corresponding points from each data set.</p>
<p>Procrustes analysis allows us to determine whether we would derive the same beta diversity conclusions, regardless of which metric was used to compare the samples. This tutorial illustrates the steps used to generate this plot, beginning with the weighted and unweighted UniFrac PCoA matrices generated in the <a class="reference external" href="./illumina_overview_tutorial.html">Illumina Overview Tutorial</a>. A similar analysis comparing 454 and Illumina sequencing of the same samples was presented in Supplementary Figure 1 of <a class="reference external" href="http://www.ncbi.nlm.nih.gov/pubmed/21624126">Moving Pictures of the Human Microbiome</a>.</p>
<p>p-values for Procrustes Analysis are generated using a Monte Carlo simulation. Sample identifiers are shuffled in one of the PC matrices, and the M2 value is re-computed <tt class="docutils literal"><span class="pre">--random_trials</span></tt> times. The proportion of M2 values that are equal to or lower than the actual M2 value is the Monte Carlo p-value.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">It is very common to see low p-values from Procrustes Analyses, even when the test statistic is high. You should ensure that you have both a low M2 value, and a low p-value from Procrustes Analysis.</p>
</div>
<p>First, we&#8217;ll perform initial set up for the tutorial:</p>
<div class="highlight-python"><div class="highlight"><pre>wget ftp://ftp.microbio.me/qiime/tutorial_files/moving_pictures_tutorial-1.9.0.tgz
tar -xzf moving_pictures_tutorial-1.9.0.tgz
cd moving_pictures_tutorial-1.9.0
</pre></div>
</div>
<p>Next, we&#8217;ll run the Procrustes analysis on the weighted and unweighted UniFrac PCoA matrices:</p>
<div class="highlight-python"><div class="highlight"><pre>transform_coordinate_matrices.py -i illumina/precomputed-output/cdout/bdiv_even1114/unweighted_unifrac_pc.txt,illumina/precomputed-output/cdout/bdiv_even1114/weighted_unifrac_pc.txt -r 999 -o procrustes_results/
</pre></div>
</div>
<p>Finally, we&#8217;ll generate a Procrustes plot. This plot will include an explicit time axis because we&#8217;re passing <tt class="docutils literal"><span class="pre">--custom_axes</span> <span class="pre">DaysSinceExperimentStart</span></tt>, but this is not required (it helps with interpretation for this particular data set).</p>
<div class="highlight-python"><div class="highlight"><pre>make_emperor.py -c -i procrustes_results/ -o procrustes_results/plots/ -m illumina/map.tsv --custom_axes DaysSinceExperimentStart
</pre></div>
</div>
<p>There will now be several results of interest. For the Procrustes analysis you can find the statistical results in <tt class="docutils literal"><span class="pre">procrustes_results/procrustes_results.txt</span></tt> and you can view the Procrustes plot by opening <tt class="docutils literal"><span class="pre">procrustes_results/plots/index.html</span></tt> in a web browser. You should see a plot that looks like the following:</p>
<div class="figure">
<img alt="../_images/procrustes_tutorial_figure1.png" src="../_images/procrustes_tutorial_figure1.png" />
</div>
<div class="section" id="comparing-data-sets-with-different-sample-ids">
<h2>Comparing data sets with different sample ids<a class="headerlink" href="#comparing-data-sets-with-different-sample-ids" title="Permalink to this headline">¶</a></h2>
<p>In the example provided here, we have the same samples in our two principal coordinate matrices. If that is not the case for your study, you&#8217;ll need to pass a sample id mapping file, which is different from a QIIME metadata mapping file. For a description of this file format, see <a class="reference internal" href="../documentation/file_formats.html#sample-id-map"><em>Sample id map</em></a>.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

    
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Performing Procrustes Analysis</a><ul>
<li><a class="reference internal" href="#comparing-data-sets-with-different-sample-ids">Comparing data sets with different sample ids</a></li>
</ul>
</li>
</ul>


    <h3><a href="../index.html">Site index</a></h3>
    <ul><li><ul>
    <li><a href="http://www.qiime.org">Home</a><br /></li>
    <li><a href="../install/index.html">Install</a><br /></li>
    <li><a href="index.html">Tutorials</a><br /></li>
    <li><a href="../scripts/index.html">Scripts</a><br /></li>
    <li><a href="http://help.qiime.org">Help</a><br /></li>
    <li><a href="http://qiime.org/home_static/dataFiles.html">Resources</a><br /></li>
    <li><a href="../documentation/index.html">File Formats</a><br /></li>
    <li><a href="http://workshops.qiime.org">Workshops</a><br /></li>
    <li><a href="http://qiime.wordpress.com">Blog</a><br /></li>
    <li><a href="../developer/index.html">Developer</a><br /></li>
    </ul></li></ul>


  <h4>Previous topic</h4>
  <p class="topless"><a href="running_supervised_learning.html"
                        title="previous chapter">Running Supervised Learning</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="source_tracking.html"
                        title="next chapter">Tracking the source of microbes with SourceTracker</a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="source_tracking.html" title="Tracking the source of microbes with SourceTracker"
             >next</a> |</li>
        <li class="right" >
          <a href="running_supervised_learning.html" title="Running Supervised Learning"
             >previous</a> |</li>
        <li><a href="../index.html">Home</a> &raquo;</li>
          <li><a href="index.html" >QIIME Tutorials</a> &raquo;</li> 
      </ul>
    </div>
<div style="text-align: center; padding: 0px;"><br />
<a href="http://www.scikit-bio.org" target="_blank"><img src="../_static/powered_by_skbio.png" border="0" alt="sampledoc" height="70px"/></a>
<br /></div>

    <div class="footer">
        &copy; Copyright 2010-2014, QIIME Team.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
try {
var pageTracker = _gat._getTracker("UA-6636235-4");
pageTracker._trackPageview();
} catch(err) {}</script>

  </body>
</html>